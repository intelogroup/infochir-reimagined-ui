
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Infochir-RHCA | Votre Espace Scientifique En Ligne</title>
    <meta name="description" content="Votre Espace Scientifique En Ligne - Ressources médicales et scientifiques pour les professionnels de la santé en Haïti et dans la Caraïbe." />
    <meta name="author" content="Infochir-RHCA" />
    
    <!-- Content Security Policy - Updated to allow necessary connections -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' wss://*.lovable.ai https://*.supabase.co https://*.stripe.com vitals.vercel-insights.com https://ingesteer.services-prod.nsvcs.net wss://*.supabase.co; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.stripe.com https://m.stripe.network https://cdn.gpteng.co https://vitals.vercel-insights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; frame-src 'self' https://*.stripe.com https://*.supabase.co; media-src 'self' data:; object-src 'none'; worker-src 'self' blob:;" />
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Infochir-RHCA | Votre Espace Scientifique En Ligne" />
    <meta property="og:description" content="Votre Espace Scientifique En Ligne - Ressources médicales et scientifiques pour les professionnels de la santé en Haïti et dans la Caraïbe." />
    <meta property="og:image" content="/og-image.png" />
    <meta property="og:url" content="https://info-chir.org" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Infochir-RHCA | Votre Espace Scientifique En Ligne" />
    <meta name="twitter:description" content="Votre Espace Scientifique En Ligne - Ressources médicales et scientifiques pour les professionnels de la santé en Haïti et dans la Caraïbe." />
    <meta name="twitter:image" content="/og-image.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="keywords" content="Infochir, RHCA, médecine, chirurgie, anesthésiologie, Haïti, science médicale, formation médicale, recherche" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://info-chir.org" />
    
    <!-- Resource hints for fast loading -->
    <link rel="preconnect" href="https://llxzstqejdrplmxdjxlu.supabase.co" crossorigin />
    <link rel="dns-prefetch" href="https://llxzstqejdrplmxdjxlu.supabase.co" />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdn.gpteng.co" crossorigin />
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/lovable-uploads/75589792-dc14-4d53-9aae-5796c76a3b39.png" as="image" fetchpriority="high" />
    <link rel="preload" href="/src/index.css" as="style" />
    <link rel="preload" href="/lovable-uploads/cb9e38f1-3a2c-4310-a9eb-e65ee5c932a8.png" as="image" />
    
    <!-- Prefetch primary routes -->
    <link rel="prefetch" href="/about" as="document" />
    <link rel="prefetch" href="/rhca" as="document" />
    <link rel="prefetch" href="/igm" as="document" />
    
    <!-- Favicon -->
    <link rel="icon" href="/lovable-uploads/cb9e38f1-3a2c-4310-a9eb-e65ee5c932a8.png" type="image/png">
    <link rel="shortcut icon" href="/lovable-uploads/cb9e38f1-3a2c-4310-a9eb-e65ee5c932a8.png" type="image/png">
    <link rel="apple-touch-icon" href="/lovable-uploads/cb9e38f1-3a2c-4310-a9eb-e65ee5c932a8.png">
    
    <!-- Cache control meta tags -->
    <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate" />
    
    <!-- Add JS detection immediately -->
    <script>
      (function() {
        document.documentElement.classList.remove('no-js');
        document.documentElement.classList.add('js');
        
        // Add performance marks for measuring load times
        if (window.performance && window.performance.mark) {
          window.performance.mark('app-init-start');
          performance.clearMarks = performance.clearMarks || function(){};
          performance.clearMeasures = performance.clearMeasures || function(){};
          performance.measure = performance.measure || function(){};
          performance.getEntriesByType = performance.getEntriesByType || function(){ return []; };
        }
        
        // Register service worker eagerly
        if ('serviceWorker' in navigator) {
          try {
            navigator.serviceWorker.register('/sw.js')
              .catch(function(err) {
                console.log('ServiceWorker registration failed: ', err);
              });
          } catch (e) {
            console.error('Service worker registration error:', e);
          }
        }
      })();
    </script>
    
    <!-- Inline critical CSS for fastest rendering -->
    <style>
      /* Critical CSS for initial render */
      :root { --bg-main: #f8fafc; --text-main: #1f2937; --blue-primary: #1E40AF; --transition-default: all 0.3s ease; }
      body { margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: var(--bg-main); color: var(--text-main); }
      .no-js-warning { display: none; }
      .no-js .no-js-warning { display: block; padding: 20px; text-align: center; background: var(--bg-main); color: var(--text-main); }
      .js-content { display: block; }
      .no-js .js-content { display: none; }
      #initial-loader { display: flex; position: fixed; inset: 0; justify-content: center; align-items: center; background: linear-gradient(to bottom, var(--bg-main), #ffffff); z-index: 9999; opacity: 1; transition: opacity 0.3s ease; }
      .loader-spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--blue-primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .loader-text { font-family: sans-serif; color: #666; }
      
      /* Nav placeholder to prevent layout shift */
      .nav-placeholder { height: 64px; width: 100%; }
      
      /* Hero section minimal styles */
      .hero-placeholder { min-height: 400px; background: linear-gradient(to right, #f9fafb, #f3f4f6); display: flex; align-items: center; justify-content: center; margin-bottom: 2rem; }
      
      /* Animate content when it loads */
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .fade-in { animation: fadeIn 0.5s ease forwards; }
    </style>
    
    <!-- GPT Engineer script must be before the main application script -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  </head>

  <body>
    <!-- Initial visible loader -->
    <div id="initial-loader">
      <div style="text-align: center">
        <div class="loader-spinner"></div>
        <p class="loader-text">Chargement de l'application...</p>
      </div>
    </div>
    
    <!-- Nav placeholder to prevent layout shift -->
    <div class="nav-placeholder" aria-hidden="true"></div>
    
    <!-- No JavaScript fallback -->
    <div class="no-js-warning">
      <h1>JavaScript Required</h1>
      <p>We're sorry, but this application requires JavaScript to function properly. Please enable JavaScript in your browser settings and reload the page.</p>
      <p>If you cannot enable JavaScript, you can:</p>
      <ul style="list-style: none; padding: 0;">
        <li>Contact us at support@infochir.com</li>
        <li>Visit our static content at static.infochir.com</li>
        <li>Call us at +1234567890</li>
      </ul>
    </div>
    
    <!-- Main app content -->
    <div id="root" class="js-content"></div>
    
    <!-- Modals container to separate from main app -->
    <div id="modals-root"></div>
    
    <!-- Script to monitor and optimize loading -->
    <script>
      // Monitor page load performance
      const monitorPerformance = () => {
        if (!window.performance || !window.performance.getEntriesByType) return;
        
        // Get timing metrics
        const pageLoadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
        const domContentLoadedTime = window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart;
        
        console.log(`Page load: ${pageLoadTime}ms, DOM content loaded: ${domContentLoadedTime}ms`);
        
        // Report to analytics if it's too slow (over 3 seconds)
        if (pageLoadTime > 3000) {
          console.warn('Page load time is too slow:', pageLoadTime);
        }
      };
      
      window.addEventListener('load', function() {
        // Mark load event
        if (window.performance && window.performance.mark) {
          window.performance.mark('page-loaded');
          window.performance.measure('full-page-load', 'app-init-start', 'page-loaded');
        }
        
        // Log performance data
        setTimeout(monitorPerformance, 0);
        
        // Remove initial loader
        const loader = document.getElementById('initial-loader');
        if (loader) {
          loader.style.opacity = '0';
          setTimeout(() => {
            loader.style.display = 'none';
          }, 300);
        }
        
        // Remove nav placeholder when real nav is loaded
        setTimeout(() => {
          const navPlaceholder = document.querySelector('.nav-placeholder');
          if (navPlaceholder) {
            navPlaceholder.style.display = 'none';
          }
        }, 100);
      });
      
      // Add global error handler for debugging
      window.addEventListener('error', function(event) {
        console.error('Global error caught:', event.error);
        
        // Log more details about network errors if possible
        if (event.error && event.error.name === 'NetworkError') {
          console.error('Network error details:', {
            message: event.error.message,
            url: event.error.fileName || event.filename,
            lineNumber: event.error.lineNumber || event.lineno
          });
        }
      });
      
      // Enhanced page load monitoring
      document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded successfully at', new Date().toISOString());
        
        // Check for any network issues
        if (!navigator.onLine) {
          console.warn('Page loaded in offline mode - network functionality will be limited');
        }
      });
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
